<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>IELTS Writing Task 1 — Guided Wizard</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">

  <style>
    /* ---- Wizard-specific inline styles ---- */
    :root{
      --accent:#0d6efd;
      --bg:#f7f9fb;
      --card:#ffffff;
      --muted:#6c757d;
    }
    html,body{
      height:100%;
    }
    body {
      background: var(--bg);
      font-family: "Poppins", sans-serif;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      margin:0;
    }

    /* full-screen centered login */
    #login-section {
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background: linear-gradient(180deg, rgba(13,110,253,0.06), rgba(255,255,255,0.02));
      padding: 2rem;
    }
    .login-card {
      width:100%;
      max-width:520px;
      background:var(--card);
      padding:2rem;
      border-radius:.75rem;
      box-shadow: 0 10px 30px rgba(12,16,40,0.08);
      text-align:center;
    }
    .login-card h2{ margin-bottom:1rem; font-weight:600;}
    .login-card .form-control{ margin-top:.5rem; }

    /* sticky mini header inside wizard */
    #wizard-header {
      position: sticky;
      top: 0;
      z-index: 1050;
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(4px);
      border-bottom:1px solid #eee;
    }
    #wizard-header .container {
      padding: .75rem 1rem;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    .progress {
      height:10px;
      background:#eee;
      border-radius:999px;
      overflow:hidden;
    }
    .progress .progress-bar {
      background:linear-gradient(90deg,var(--accent),#6610f2);
      height:10px;
      width:0%;
      transition: width .45s ease;
    }

    main.wizard-main{
      min-height: calc(100vh - 64px);
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding:2.5rem 1rem;
    }
    .wizard-container{
      width:100%;
      max-width:980px;
      background:transparent;
    }
    .wizard-card {
      background:var(--card);
      border-radius:.6rem;
      padding:1.6rem;
      box-shadow: 0 8px 24px rgba(12,16,40,0.06);
      margin-bottom:1rem;
      overflow:hidden;
    }

    .wizard-footer {
      display:flex;
      justify-content:space-between;
      gap:1rem;
      align-items:center;
      margin-top:.5rem;
    }

    .hidden{ display:none !important; }

    /* Timer overlay */
    #timerOverlay {
      margin-top:1rem;
      padding:1rem;
      border-radius:.5rem;
      background:linear-gradient(180deg,#fff,#fbfdff);
      border:1px solid #eef3ff;
      text-align:center;
    }
    #timerDisplay {
      font-size:2rem;
      font-weight:700;
      letter-spacing:.6px;
    }

    /* Step number pill */
    .step-pill {
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:36px;height:36px;border-radius:999px;
      background:var(--accent); color:#fff;
      font-weight:600;
    }

    /* content spacing */
    .vocab-table td, .vocab-table th { vertical-align:middle; }
    @media (max-width:768px){
      .speaking-row, .vocab-word:hover {
        background-color: #e9f5ff !important;
        transition: background-color 0.3s ease;
      }

    @media (max-width:768px){
      .login-card { padding:1.2rem; margin: 0 8px; }
      .wizard-container{ padding:0 12px; }
      #wizard-header .container{ padding: .5rem; }
    }
  </style>
</head>

<body class="starter-page-page">

  <!-- LOGIN SECTION (FULLSCREEN) -->
  <section id="login-section" aria-label="Login section" data-aos="fade-up">
    <div class="login-card" role="dialog" aria-labelledby="loginTitle">
      <h2 id="loginTitle">Enter Access Password</h2>
      <p class="mb-3 text-muted">This wizard is password-protected. Enter the passphrase to continue.</p>

      <div class="mb-3 text-start" data-aos="fade-right">
        <label for="passwordInput" class="form-label">Passphrase</label>
        <input id="passwordInput" type="password" class="form-control" placeholder="Enter passphrase">
        <div id="loginError" class="text-danger mt-2 hidden" role="alert">Incorrect passphrase. Try again.</div>
      </div>

      <div class="d-grid mt-3" data-aos="fade-up" data-aos-delay="150">
        <button id="loginBtn" class="btn btn-primary px-4">Unlock</button>
      </div>
    </div>
  </section>

  <!-- WIZARD HEADER (STICKY) -->
  <header id="wizard-header" class="hidden" aria-hidden="true" data-aos="fade-down">
    <div class="container">
      <div class="d-flex align-items-center gap-3">
        <div class="step-pill" id="stepPill">1</div>
        <div>
          <div id="stepTitle" style="font-weight:600">Step 1: Task Overview</div>
          <small id="stepCounter" class="text-muted">1 / 7</small>
        </div>
      </div>

      <div style="width:46%;">
        <div class="progress" aria-hidden="false" aria-label="Progress">
          <div id="progressBar" class="progress-bar" role="progressbar" style="width:0%;"></div>
        </div>
      </div>
    </div>
  </header>

  <!-- MAIN WIZARD -->
  <main class="wizard-main hidden">
    <div class="wizard-container">

      <!-- STEP 1 - TASK OVERVIEW -->
      <section id="step1" class="wizard-card" data-step="1" data-aos="fade-up">
        <div class="d-flex justify-content-between align-items-start">
          <div>
            <h3>Task Overview</h3>
            <p class="text-muted">Choose an overview media (audio/video) to get a guided briefing for your Task 1.</p>
          </div>
          <div class="text-end text-muted"><small>Estimated time: 1-2 min</small></div>
        </div>

        <hr>

        <!-- Tab Navigation -->
        <ul class="nav nav-tabs" id="overviewTab" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="audio-tab" data-bs-toggle="tab" data-bs-target="#audio-pane" type="button" role="tab" aria-controls="audio-pane" aria-selected="true">Audio Overview</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="video-tab" data-bs-toggle="tab" data-bs-target="#video-pane" type="button" role="tab" aria-controls="video-pane" aria-selected="false">Video Overview</button>
          </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content pt-3" id="overviewTabContent">
          <div class="tab-pane fade show active" id="audio-pane" role="tabpanel" aria-labelledby="audio-tab" data-aos="fade-up">
            <p class="small text-muted">A concise audio walkthrough of approach & tips. The step marks complete when the audio ends.</p>
            <audio id="overviewAudio" controls style="width:100%;">
              <source src="materials/week-25-fri-wt1-audio.mp3" type="audio/mpeg">
              Your browser does not support the audio element.
            </audio>
          </div>
          <div class="tab-pane fade" id="video-pane" role="tabpanel" aria-labelledby="video-tab" data-aos="fade-up">
            <p class="small text-muted">A short video overview (or speaker notes). The step marks complete when the video ends.</p>
            <video id="overviewVideo" controls style="width:100%; border-radius:.4rem;">
              <source src="materials/random.mp4" type="video/mp4">
              Your browser does not support the video tag.
            </video>
          </div>
        </div>

        <div id="mediaCompleteBadge" class="mt-3 hidden" data-aos="zoom-in">
          <span class="badge bg-success">Overview Completed ✓</span>
        </div>
      </section>

      <!-- STEP 2 - BRAINSTORM (3-MIN TIMER) -->
      <section id="step2" class="wizard-card hidden" data-step="2" data-aos="fade-up">
        <div class="d-flex justify-content-between align-items-start">
          <div>
            <h3>Brainstorm (3-minute focus)</h3>
            <p class="text-muted">Read the Task 1 question and study the chart. Use the timer to focus on planning.</p>
          </div>
          <div class="text-muted text-end"><small>Focus timer</small></div>
        </div>

        <hr>

        <div class="row g-3">
          <div class="col-lg-7" data-aos="fade-right">
            <div class="mb-3">
              <h6>Task 1 Question</h6>
              <p class="small">The diagram below shows how the water cycle works. Write a report for a university lecturer describing the information given below.</p>
            </div>
          </div>

          <div class="col-lg-5" data-aos="fade-left">
            <figure class="figure">
              <a href="materials/week-25-fri-wt1.png" class="glightbox">
                <img src="materials/week-25-fri-wt1.png" alt="Task Chart" class="img-fluid rounded" />
              </a>
              <figcaption class="figure-caption small text-muted">Click image to enlarge.</figcaption>
            </figure>

            <div class="mt-3">
              <button id="startTimerBtn" class="btn btn-primary w-100">Start 3-Minute Timer</button>
            </div>

            <div id="timerOverlay" class="hidden" aria-live="polite">
              <div id="timerDisplay">03:00</div>
              <p class="small text-muted mt-2">Think about trends! Jot main points: comparisons, extremes, exceptions.</p>
            </div>
          </div>
        </div>
      </section>

      <!-- STEP 3 - VOCABULARY TABLE -->
      <section id="step3" class="wizard-card hidden" data-step="3" data-aos="fade-up">
        <div class="d-flex justify-content-between">
          <div>
            <h3>Vocabulary Table</h3>
            <p class="text-muted">High-level vocabulary to use in your Task 1 report.</p>
          </div>
          <div class="text-muted"><small>Use pronunciation &amp; examples</small></div>
        </div>

        <hr>

        <div class="table-responsive" data-aos="fade-up" data-aos-delay="100">
          <table class="table table-bordered vocab-table">
            <thead class="table-light">
              <tr>
                <th style="width:25%;">Word</th>
                <th style="width:45%;">Meaning</th>
                <th style="width:30%;">Example</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="vocab-word" role="button" tabindex="0">Percolates</td>
                <td>To slowly pass or seep through a porous substance.</td>
                <td>A portion of rainwater percolates through porous rock to form underground water reserves.</td>
              </tr>
              <tr>
                <td class="vocab-word" role="button" tabindex="0">Concurrently</td>
                <td>Happening at the same time as something else.</td>
                <td>Water evaporates from the sea, while moisture is concurrently released through transpiration from plants.</td>
              </tr>
              <tr>
                <td class="vocab-word" role="button" tabindex="0">Permeates</td>
                <td>Spreads or flows through something.</td>
                <td>Water permeates underground rock layers before resurfacing.</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="d-flex gap-2 align-items-center mt-3" data-aos="fade-up" data-aos-delay="150">
          <label for="accentSelect" class="me-2 mb-0 small text-muted">Accent</label>
          <select id="accentSelect" class="form-select form-select-sm w-auto">
            <option value="en-GB">UK (en-GB)</option>
            <option value="en-IN">Indian (en-IN)</option>
            <option value="en-US">US (en-US)</option>
          </select>
        </div>

      </section>

      <!-- STEP 4 - INTRODUCTION & OVERVIEW -->
      <section id="step4" class="wizard-card hidden" data-step="4" data-aos="fade-up">
        <div class="d-flex justify-content-between">
          <div>
            <h3>Plan: Introduction &amp; Overview</h3>
            <p class="text-muted">Use these sample introductions and overviews to build your report.</p>
          </div>
          <div class="text-muted"><small>Paraphrase the prompt</small></div>
        </div>

        <hr>

        <div class="row g-3">
          <div class="col-md-6" data-aos="fade-right">
            <h6>Sample Introductions</h6>
            <div class="mb-2">
              <div class="p-2" style="background:#fbfbff;border-radius:.4rem;">
                <strong>SAMPLE INTRODUCTION</strong>
                <p class="small mb-0">The cycle illustrates the way in which the water operates in nature.</p>
              </div>
            </div>
          </div>

          <div class="col-md-6" data-aos="fade-left">
            <h6>Sample Overviews</h6>
            <div class="mb-2">
              <div class="p-2" style="background:#fffaf0;border-radius:.4rem;">
                <strong>SAMPLE OVERVIEW</strong>
                <p class="small mb-0">Overall, this is a natural cyclical system comprising three main stages, beginning with evaporation and ending with the return of water to the sea. A particularly striking feature is the sun, which acts as the primary driving force by supplying the heat energy required to initiate and sustain the entire cycle.</p>
              </div>
            </div>
          </div>
        </div>

      </section>

      <!-- STEP 5 - BODY PARAGRAPH 1 -->
      <section id="step5" class="wizard-card hidden" data-step="5" data-aos="fade-up">
        <div class="d-flex justify-content-between">
          <div>
            <h3>Plan: Body Paragraph 1</h3>
            <p class="text-muted">Evaporation, transpiration, and cloud formation</p>
          </div>
          <div class="text-muted"><small>Focus on the initial stages</small></div>
        </div>

        <hr>

        <div class="checklist-container" data-aos="fade-up">
          <ul>
            <li>At the initial stage, solar heat causes water stored in seas, rivers, and lakes to evaporate, forming invisible water vapour.</li>
            <li>Concurrently, moisture is released into the atmosphere through transpiration from plants and trees.</li>
            <li>As the vapour rises, it cools and undergoes condensation, resulting in the formation of clouds.</li>
            <li>These clouds are then displaced by wind towards inland and elevated regions.</li>
          </ul>
        </div>
      </section>

      <!-- STEP 6 - BODY PARAGRAPH 2 -->
      <section id="step6" class="wizard-card hidden" data-step="6" data-aos="fade-up">
        <div class="d-flex justify-content-between">
          <div>
            <h3>Plan: Body Paragraph 2</h3>
            <p class="text-muted">Precipitation, surface flow, and groundwater movement</p>
          </div>
          <div class="text-muted"><small>Focus on the return flow</small></div>
        </div>

        <hr>

        <div class="checklist-container" data-aos="fade-up">
          <ul>
            <li>Subsequently, further cooling within the clouds leads to precipitation, primarily in the form of rainfall.</li>
            <li>Following this, rainwater flows over the land surface and is channelled downstream by rivers.</li>
            <li>At the same time, a portion of water percolates through porous rock, forming underground water reserves.</li>
            <li>Ultimately, groundwater and surface water re-enter lakes, rivers, and seas, thereby completing the cycle and allowing the process to recommence.</li>
          </ul>
        </div>
      </section>

      <!-- STEP 7 - FINAL REVIEW & DOWNLOAD -->
      <section id="step7" class="wizard-card hidden text-center" data-step="7" data-aos="fade-up">
        <h3>Final Review &amp; Download</h3>
        <p class="text-muted">Review your notes and download the tutor report or return home.</p>

        <div class="my-3">
          <img src="materials/qrcode_todayieltstask.onrender.com.png" alt="QR code for today's task" width="200" class="img-fluid rounded" />
        </div>

        <div class="d-flex justify-content-center gap-3 mt-3">
          <a href="teacher-report.html" class="btn btn-warning">Tutor Report</a>
          <button class="btn btn-secondary" onclick="gotoStep(1)">Return to Home</button>
          <button id="finishBtn" class="btn btn-success" onclick="finalize()">Mark Complete</button>
        </div>

        <div id="finalMessage" class="mt-3 hidden">
          <div class="alert alert-success">Congratulations — your Task 1 plan is ready!</div>
        </div>
      </section>

      <!-- NAVIGATION FOOTER -->
      <div class="wizard-footer">
        <div>
          <button id="prevBtn" class="btn btn-outline-secondary" onclick="prevStep()" aria-label="Previous step">← Previous</button>
        </div>
        <div>
          <button id="nextBtn" class="btn btn-primary" onclick="nextStep()">Next →</button>
        </div>
      </div>

    </div>
  </main>


  <!-- Preloader (keep original file's element, but wizard doesn't rely on it) -->
  <div id="preloader" class="hidden"></div>

  <!-- Vendor JS Files (kept exact like original) -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>

  <!-- Main JS File (kept as in your template) -->
  <script src="assets/js/main.js"></script>

  <!-- INLINE WIZARD LOGIC -->
  <script>
    // ---------- Configuration ----------
    const CORRECT_PASS = "VII I MMVI"; // exact passphrase
    const TOTAL_STEPS = 7;

    // ---------- Elements ----------
    const loginSection = document.getElementById('login-section');
    const loginBtn = document.getElementById('loginBtn');
    const loginHintBtn = document.getElementById('loginHintBtn');
    const passwordInput = document.getElementById('passwordInput');
    const loginError = document.getElementById('loginError');

    const wizardHeader = document.getElementById('wizard-header');
    const stepPill = document.getElementById('stepPill');
    const stepTitle = document.getElementById('stepTitle');
    const stepCounter = document.getElementById('stepCounter');
    const progressBar = document.getElementById('progressBar');

    let currentStep = 1;
    let timerInterval = null;
    let timerRemaining = 0;

    // Utility
    function qs(id){ return document.getElementById(id); }
    function show(el){ el.classList.remove('hidden'); }
    function hide(el){ el.classList.add('hidden'); }

    // ---------- Login ----------
    loginBtn.addEventListener('click', () => {
      const val = passwordInput.value.trim();
      if (val === CORRECT_PASS) {
        hide(loginSection);
        document.querySelector('.wizard-main').classList.remove('hidden');
        show(wizardHeader);
        gotoStep(1);
        // Find the GLightbox instance created by main.js and refresh it
        // to discover the newly visible links.
        if (window.glightbox) {
          window.glightbox.reload();
        }
        AOS.refresh();
      } else {
        loginError.classList.remove('hidden');
        setTimeout(()=> loginError.classList.add('hidden'), 3000);
      }
    });

    // ---------- Step Navigation ----------
    function updateHeader() {
      stepPill.textContent = currentStep;
      stepTitle.textContent = `Step ${currentStep}: ${getStepName(currentStep)}`;
      stepCounter.textContent = `${currentStep} / ${TOTAL_STEPS}`;

      const pct = Math.round(((currentStep - 1) / (TOTAL_STEPS - 1)) * 100);
      progressBar.style.width = pct + '%';
    }

    function getStepName(step){
      switch(step){
        case 1: return 'Task Overview';
        case 2: return 'Brainstorm';
        case 3: return 'Vocabulary';
        case 4: return 'Introduction & Overview';
        case 5: return 'Body Paragraph 1';
        case 6: return 'Body Paragraph 2';
        case 7: return 'Final Review';
        default: return 'Step';
      }
    }

    function hideAllSteps(){
      for(let i=1;i<=TOTAL_STEPS;i++){
        const s = document.querySelector('[data-step="'+i+'"]');
        if(s) s.classList.add('hidden');
      }
    }

    function gotoStep(step){
      if(step < 1) step = 1;
      if(step > TOTAL_STEPS) step = TOTAL_STEPS;
      currentStep = step;
      hideAllSteps();
      const el = document.querySelector('[data-step="'+step+'"]');
      if(el) el.classList.remove('hidden');

      updateHeader();
      // Adjust nav buttons:
      document.getElementById('prevBtn').style.visibility = (currentStep === 1) ? 'hidden' : 'visible';
      document.getElementById('nextBtn').style.visibility = (currentStep === TOTAL_STEPS) ? 'hidden' : 'visible';

      // Scroll into view the wizard container
      window.scrollTo({ top: 0, behavior: 'smooth' });

      AOS.refresh();
    }

    function nextStep(){
      if(currentStep < TOTAL_STEPS){
        gotoStep(currentStep + 1);
      }
    }
    function prevStep(){
      if(currentStep > 1){
        gotoStep(currentStep - 1);
      }
    }

    // ---------- Timer Logic (Step 2) ----------
    const startTimerBtn = qs('startTimerBtn');
    const timerOverlay = qs('timerOverlay');
    const timerDisplay = qs('timerDisplay');

    startTimerBtn && startTimerBtn.addEventListener('click', () => {
      // if timer already running, ignore
      if (timerInterval) return;

      timerRemaining = 180; // 3 minutes
      show(timerOverlay);
      updateTimerDisplay();

      timerInterval = setInterval(() => {
        timerRemaining--;
        updateTimerDisplay();

        if (timerRemaining <= 0){
          clearInterval(timerInterval);
          timerInterval = null;
          timerFinished();
        }
      }, 1000);
    });

    function updateTimerDisplay(){
      const min = Math.floor(timerRemaining / 60).toString().padStart(2,'0');
      const sec = (timerRemaining % 60).toString().padStart(2,'0');
      timerDisplay.textContent = `${min}:${sec}`;
    }

    function timerFinished(){
      // show finished alert and auto-progress to next step
      alert('Timer complete — great job! Moving to the next step.');
      nextStep();
    }

    // ---------- Media Completion (Step 1) ----------
    const overviewAudio = qs('overviewAudio');
    const overviewVideo = qs('overviewVideo');
    const mediaCompleteBadge = qs('mediaCompleteBadge');

    function markMediaComplete(){
      if(mediaCompleteBadge) show(mediaCompleteBadge);
    }

    overviewAudio && overviewAudio.addEventListener('ended', markMediaComplete);
    overviewVideo && overviewVideo.addEventListener('ended', markMediaComplete);


    // ---------- Text-to-Speech for Vocabulary (Step 3) ----------
    function speak(text, lang, onEndCallback){
      if(!('speechSynthesis' in window)){
        alert('Speech synthesis not supported on this browser.');
        return;
      }
      const u = new SpeechSynthesisUtterance(text);
      u.lang = lang || 'en-GB';
      if (onEndCallback) {
        u.onend = onEndCallback;
      }
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(u);
    }
    
    document.querySelectorAll('.vocab-word').forEach(wordCell => {
      wordCell.style.cursor = 'pointer';
      wordCell.addEventListener('click', () => {
        const word = wordCell.textContent.trim();
        const row = wordCell.parentElement;
        row.classList.add('speaking-row');
        const accent = qs('accentSelect').value;
        speak(word, accent, () => {
          // Remove highlight after speaking is finished
          setTimeout(() => row.classList.remove('speaking-row'), 300);
        });
      });
    });

    // ---------- Save & Finalize ----------
    function finalize(){
      // mark final completed
      qs('finalMessage').classList.remove('hidden');
      document.getElementById('finishBtn').disabled = true;
      // optionally clear timer
      if(timerInterval){ clearInterval(timerInterval); timerInterval = null; }
      // lock navigation
      document.getElementById('nextBtn').disabled = true;
      document.getElementById('prevBtn').disabled = true;
      // save state
      localStorage.setItem('ielts_finalized', '1');
    }

    // ---------- Presentation Mode (for Smartboard Teaching) ----------
    const presentationModeBtn = qs('presentationModeBtn');
    const presentationControls = qs('presentationControls');
    const exitPresentationBtn = qs('exitPresentationBtn');
    const highlighterToggleBtn = qs('highlighterToggleBtn');
    const clearHighlightsBtn = qs('clearHighlightsBtn');
    const canvas = qs('highlighterCanvas');
    const ctx = canvas.getContext('2d');
    let isHighlighterActive = false;
    let isDrawing = false;

    function enterPresentationMode() {
      document.documentElement.requestFullscreen();
      show(presentationControls);
      hide(qs('wizard-footer'));
    }

    function exitPresentationMode() {
      if (document.fullscreenElement) {
        document.exitFullscreen();
      }
      hide(presentationControls);
      show(qs('wizard-footer'));
      clearHighlights();
      isHighlighterActive = false;
      highlighterToggleBtn.classList.remove('active');
      canvas.style.pointerEvents = 'none';
    }

    function toggleHighlighter() {
      isHighlighterActive = !isHighlighterActive;
      highlighterToggleBtn.classList.toggle('active');
      canvas.style.pointerEvents = isHighlighterActive ? 'auto' : 'none';
    }

    function clearHighlights() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function setupCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      ctx.strokeStyle = 'rgba(255, 255, 0, 0.4)'; // Yellow highlighter
      ctx.lineWidth = 20;
      ctx.lineCap = 'round';

      canvas.addEventListener('mousedown', (e) => {
        if (!isHighlighterActive) return;
        isDrawing = true;
        ctx.beginPath();
        ctx.moveTo(e.clientX, e.clientY);
      });

      canvas.addEventListener('mousemove', (e) => {
        if (!isDrawing || !isHighlighterActive) return;
        ctx.lineTo(e.clientX, e.clientY);
        ctx.stroke();
      });

      canvas.addEventListener('mouseup', () => isDrawing = false);
      canvas.addEventListener('mouseout', () => isDrawing = false);
    }

    presentationModeBtn.addEventListener('click', enterPresentationMode);
    exitPresentationBtn.addEventListener('click', exitPresentationMode);
    highlighterToggleBtn.addEventListener('click', toggleHighlighter);
    clearHighlightsBtn.addEventListener('click', clearHighlights);
    window.addEventListener('resize', setupCanvas);

    // ---------- Init AOS & initial UI ----------
    document.addEventListener('DOMContentLoaded', function(){
      // Initialize AOS (already included in vendor scripts)
      if(window.AOS){
        AOS.init({ duration: 500, once: false, easing: 'ease-out-cubic' });
      }

      // Hide header on first load; user must login
      wizardHeader.classList.add('hidden');
      // Hide all step sections initially (they will be revealed when logged in)
      hideAllSteps();

      // Setup presentation mode canvas
      setupCanvas();
    });

    // Make some helpful keyboard shortcuts (for power users)
    document.addEventListener('keydown', (e) => {
      if(e.altKey && e.key === 'ArrowRight') nextStep();
      if(e.altKey && e.key === 'ArrowLeft') prevStep();
      if(e.key === 'Escape') { /* no-op for now */ }
    });
  </script>

</body>
</html>